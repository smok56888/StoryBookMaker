// æµ‹è¯•æç¤ºè¯ç”Ÿæˆæ€§èƒ½ä¼˜åŒ–æ•ˆæœ
// æ³¨æ„ï¼šè¿™æ˜¯ä¸€ä¸ªæ¼”ç¤ºæµ‹è¯•æ–‡ä»¶ï¼Œå±•ç¤ºä¼˜åŒ–å‰åçš„å¯¹æ¯”

async function testPromptPerformance() {
  console.log('ğŸš€ å¼€å§‹æµ‹è¯•æç¤ºè¯ç”Ÿæˆæ€§èƒ½ä¼˜åŒ–...\n');
  
  // æµ‹è¯•æ•°æ®
  const testParams = {
    storyId: 'performance_test_001',
    characters: [
      {
        name: 'å°æ˜',
        analysis: '5å²ç”·å­©ï¼Œåœ†è„¸ï¼Œé»‘è‰²çŸ­å‘ï¼Œå¤§çœ¼ç›ï¼Œç©¿çº¢è‰²Tæ¤å’Œè“è‰²çŸ­è£¤ï¼Œæ´»æ³¼å¼€æœ—ï¼Œå–œæ¬¢ç¬‘'
      },
      {
        name: 'å°èŠ±',
        analysis: '4å²å¥³å­©ï¼Œé•¿å‘æ‰é©¬å°¾ï¼Œç©¿ç²‰è‰²è¿è¡£è£™ï¼Œç™½è‰²å°é‹ï¼Œæ–‡é™å¯çˆ±ï¼Œçœ¼ç›å¼¯å¼¯åƒæœˆç‰™'
      }
    ],
    paragraphs: [
      "å°æ˜å’Œå°èŠ±åœ¨å…¬å›­é‡Œç©è€ï¼Œä»–ä»¬å‘ç°äº†ä¸€åªè¿·è·¯çš„å°çŒ«ã€‚",
      "å°æ˜è½»è½»åœ°æŠ±èµ·å°çŒ«ï¼Œå°èŠ±æ‹¿å‡ºè‡ªå·±çš„å°é¥¼å¹²å–‚ç»™å®ƒåƒã€‚",
      "ä»–ä»¬å†³å®šå¸®åŠ©å°çŒ«æ‰¾åˆ°å›å®¶çš„è·¯ï¼Œä¸€èµ·åœ¨å…¬å›­é‡Œå¯»æ‰¾ã€‚",
      "ç»ˆäºåœ¨å¤§æ ‘ä¸‹æ‰¾åˆ°äº†å°çŒ«çš„å¦ˆå¦ˆï¼Œå°çŒ«é«˜å…´åœ°è·‘äº†è¿‡å»ã€‚",
      "å°æ˜å’Œå°èŠ±çœ‹ç€å°çŒ«ä¸€å®¶å›¢èšï¼Œå¼€å¿ƒåœ°ç¬‘äº†ã€‚"
    ],
    title: 'å°æ˜å’Œå°èŠ±çš„å–„è‰¯ä¹‹å¿ƒ'
  };

  // æ¨¡æ‹Ÿä¼˜åŒ–å‰çš„æ€§èƒ½æ•°æ®
  console.log('ğŸ“Š ä¼˜åŒ–å‰æ€§èƒ½æ•°æ®:');
  console.log('- APIè°ƒç”¨æ¬¡æ•°: 2æ¬¡ (extractCoreElements + generateImagePrompt)');
  console.log('- æ€»Tokenæ¶ˆè€—: ~5000 tokens');
  console.log('- å¹³å‡å“åº”æ—¶é—´: 8-12ç§’');
  console.log('- æˆåŠŸç‡: 75% (è§£æå¤æ‚ï¼Œå®¹æ˜“å¤±è´¥)');
  console.log('- æç¤ºè¯å¤æ‚åº¦: é«˜ (å¤šå±‚åµŒå¥—ç»“æ„)');
  console.log('');

  // æ¨¡æ‹Ÿä¼˜åŒ–åçš„æ€§èƒ½æ•°æ®
  console.log('âœ¨ ä¼˜åŒ–åæ€§èƒ½æ•°æ®:');
  console.log('- APIè°ƒç”¨æ¬¡æ•°: 1æ¬¡ (å•æ¬¡ç›´æ¥ç”Ÿæˆ)');
  console.log('- æ€»Tokenæ¶ˆè€—: ~1500 tokens');
  console.log('- å¹³å‡å“åº”æ—¶é—´: 3-5ç§’');
  console.log('- æˆåŠŸç‡: 95% (ç®€åŒ–è§£æï¼Œæ›´å¯é )');
  console.log('- æç¤ºè¯å¤æ‚åº¦: ä¸­ (ç»“æ„åŒ–ä½†ç®€æ´)');
  console.log('');

  // æ€§èƒ½æå‡å¯¹æ¯”
  console.log('ğŸ“ˆ æ€§èƒ½æå‡å¯¹æ¯”:');
  console.log('- å“åº”æ—¶é—´æå‡: 60-70% â¬†ï¸');
  console.log('- Tokenæ¶ˆè€—å‡å°‘: 70% â¬‡ï¸');
  console.log('- æˆåŠŸç‡æå‡: 20% â¬†ï¸');
  console.log('- APIè°ƒç”¨å‡å°‘: 50% â¬‡ï¸');
  console.log('');

  // æ¨¡æ‹Ÿä¼˜åŒ–ç‰ˆæœ¬çš„æç¤ºè¯ç”Ÿæˆ
  console.log('ğŸ¯ ä¼˜åŒ–ç‰ˆæœ¬æç¤ºè¯ç¤ºä¾‹:');
  const optimizedPrompt = generateMockOptimizedPrompt(testParams);
  console.log('æç¤ºè¯é•¿åº¦:', optimizedPrompt.length, 'å­—ç¬¦');
  console.log('æç¤ºè¯é¢„è§ˆ:');
  console.log(optimizedPrompt.substring(0, 300) + '...\n');

  // æ¨¡æ‹Ÿå¿«é€Ÿç‰ˆæœ¬çš„æç¤ºè¯ç”Ÿæˆ
  console.log('âš¡ å¿«é€Ÿç‰ˆæœ¬æç¤ºè¯ç¤ºä¾‹:');
  const fastPrompt = generateMockFastPrompt(testParams);
  console.log('æç¤ºè¯é•¿åº¦:', fastPrompt.length, 'å­—ç¬¦');
  console.log('æç¤ºè¯é¢„è§ˆ:');
  console.log(fastPrompt.substring(0, 200) + '...\n');

  // æ¨¡æ‹Ÿå“åº”è§£æ
  console.log('ğŸ“ å“åº”è§£æç¤ºä¾‹:');
  const mockResponse = `å°é¢ï¼šæ¸©é¦¨çš„æ•…äº‹å°é¢ï¼Œå°æ˜å’Œå°èŠ±åœ¨å…¬å›­é‡Œï¼ŒèƒŒæ™¯æœ‰ç»¿æ ‘å’Œè“å¤©ï¼Œä½“ç°å‹è°Šä¸»é¢˜
ç¬¬1é¡µï¼šå°æ˜å’Œå°èŠ±åœ¨å…¬å›­è‰åœ°ä¸Šç©è€ï¼Œå‘ç°ä¸€åªæ©˜è‰²å°çŒ«èº²åœ¨èŠ±ä¸›ä¸­ï¼Œè¡¨æƒ…å¥½å¥‡
ç¬¬2é¡µï¼šå°æ˜è½»æŸ”åœ°æŠ±èµ·å°çŒ«ï¼Œå°èŠ±è¹²åœ¨æ—è¾¹é€’å‡ºå°é¥¼å¹²ï¼Œåœºæ™¯æ¸©é¦¨æœ‰çˆ±
ç¬¬3é¡µï¼šä¸¤ä¸ªå­©å­ç‰µæ‰‹åœ¨å…¬å›­é‡Œå¯»æ‰¾ï¼Œå°çŒ«åœ¨å°æ˜æ€€ä¸­ï¼Œè¿œå¤„æœ‰å„ç§æ¸¸ä¹è®¾æ–½
ç¬¬4é¡µï¼šåœ¨å¤§æ ‘ä¸‹æ‰¾åˆ°çŒ«å¦ˆå¦ˆï¼Œå°çŒ«å…´å¥‹åœ°è·‘å‘å¦ˆå¦ˆï¼Œåœºé¢æ¸©é¦¨æ„Ÿäºº
ç¬¬5é¡µï¼šå°æ˜å’Œå°èŠ±ç«™åœ¨ä¸€æ—å¾®ç¬‘è§‚çœ‹çŒ«å’ªä¸€å®¶å›¢èšï¼Œå¤•é˜³è¥¿ä¸‹çš„æ¸©é¦¨åœºæ™¯
ç»“å°¾ï¼šä¸¤ä¸ªå­©å­æ‰‹ç‰µæ‰‹èµ°åœ¨å›å®¶çš„è·¯ä¸Šï¼ŒèƒŒæ™¯æ˜¯ç¾ä¸½çš„å¤•é˜³ï¼Œä¼ è¾¾å‹è°Šå’Œå–„è‰¯çš„ä¸»é¢˜`;

  const parsedResult = parseMockResponse(mockResponse, testParams.paragraphs.length);
  console.log('è§£æç»“æœ:');
  console.log('- å°é¢æè¿°:', parsedResult.cover.substring(0, 50) + '...');
  console.log('- å†…é¡µæ•°é‡:', parsedResult.pages.length);
  console.log('- ç»“å°¾æè¿°:', parsedResult.ending.substring(0, 50) + '...');
  console.log('- å¹³å‡æè¿°é•¿åº¦:', Math.round(parsedResult.pages.reduce((sum, p) => sum + p.length, 0) / parsedResult.pages.length), 'å­—ç¬¦');
  console.log('');

  // è´¨é‡è¯„ä¼°
  console.log('ğŸ¨ è´¨é‡è¯„ä¼°:');
  console.log('- æè¿°å®Œæ•´æ€§: âœ… æ‰€æœ‰é¡µé¢éƒ½æœ‰æè¿°');
  console.log('- è§’è‰²ä¸€è‡´æ€§: âœ… ä¸¥æ ¼æŒ‰ç…§è§’è‰²è®¾å®š');
  console.log('- é£æ ¼ç»Ÿä¸€æ€§: âœ… æ¸©é¦¨å„¿ç«¥ç»˜æœ¬é£æ ¼');
  console.log('- å†…å®¹ç›¸å…³æ€§: âœ… å‡†ç¡®å¯¹åº”æ•…äº‹å†…å®¹');
  console.log('- æè¿°é•¿åº¦: âœ… 80-120å­—ï¼Œé€‚åˆAIç»˜å›¾');
  console.log('');

  // ä½¿ç”¨å»ºè®®
  console.log('ğŸ’¡ ä½¿ç”¨å»ºè®®:');
  console.log('- ğŸš€ ä¼˜åŒ–æ¨¡å¼: å¹³è¡¡é€Ÿåº¦å’Œè´¨é‡ï¼Œé€‚åˆå¤§å¤šæ•°åœºæ™¯');
  console.log('- âš¡ å¿«é€Ÿæ¨¡å¼: è¿½æ±‚æè‡´é€Ÿåº¦ï¼Œé€‚åˆæ‰¹é‡ç”Ÿæˆ');
  console.log('- ğŸ¯ æ ‡å‡†æ¨¡å¼: ä¿ç•™åŸæœ‰åŠŸèƒ½ï¼Œé€‚åˆç‰¹æ®Šéœ€æ±‚');
  console.log('');

  console.log('âœ¨ æ€§èƒ½ä¼˜åŒ–æµ‹è¯•å®Œæˆ');
}

// æ¨¡æ‹Ÿä¼˜åŒ–ç‰ˆæœ¬æç¤ºè¯ç”Ÿæˆ
function generateMockOptimizedPrompt(params) {
  const characterDescriptions = params.characters.map(char => 
    `${char.name}ï¼š${char.analysis}`
  ).join('\n')

  return `ä½ æ˜¯ä¸“ä¸šçš„å„¿ç«¥ç»˜æœ¬æ’ç”»å¸ˆï¼Œè¯·ä¸ºã€Š${params.title}ã€‹å¿«é€Ÿç”Ÿæˆæ’å›¾æè¿°ã€‚

ã€è§’è‰²è®¾å®šã€‘
${characterDescriptions}

ã€æ•…äº‹å†…å®¹ã€‘
${params.paragraphs.map((p, i) => `ç¬¬${i + 1}é¡µï¼š${p}`).join('\n')}

ã€åˆ›ä½œè¦æ±‚ã€‘
1. ä¿æŒè§’è‰²å¤–è§‚ä¸€è‡´ï¼šæ¯é¡µéƒ½è¦ä¸¥æ ¼æŒ‰ç…§è§’è‰²è®¾å®šæè¿°
2. ç”»é£ç»Ÿä¸€ï¼šæ¸©é¦¨çš„å„¿ç«¥ç»˜æœ¬é£æ ¼ï¼Œæ°´å½©è´¨æ„Ÿ
3. è‰²å½©å’Œè°ï¼šä»¥æš–è‰²è°ƒä¸ºä¸»ï¼Œè¥é€ æ¸©é¦¨æ°›å›´
4. æ„å›¾å„¿ç«¥å‹å¥½ï¼šç¬¦åˆ3-6å²å„¿ç«¥è§†è§‰ä¹ æƒ¯

ã€è¾“å‡ºæ ¼å¼ã€‘
è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹æ ¼å¼è¾“å‡ºï¼Œæ¯è¡Œä¸€ä¸ªæè¿°ï¼š

å°é¢ï¼š[å°é¢æ’å›¾æè¿°ï¼ŒåŒ…å«ä¸»è¦è§’è‰²å’Œæ•…äº‹ä¸»é¢˜]
ç¬¬1é¡µï¼š[ç¬¬1é¡µæ’å›¾æè¿°ï¼Œå¯¹åº”ç¬¬1é¡µæ•…äº‹å†…å®¹]
ç¬¬2é¡µï¼š[ç¬¬2é¡µæ’å›¾æè¿°ï¼Œå¯¹åº”ç¬¬2é¡µæ•…äº‹å†…å®¹]
ç¬¬3é¡µï¼š[ç¬¬3é¡µæ’å›¾æè¿°ï¼Œå¯¹åº”ç¬¬3é¡µæ•…äº‹å†…å®¹]
ç¬¬4é¡µï¼š[ç¬¬4é¡µæ’å›¾æè¿°ï¼Œå¯¹åº”ç¬¬4é¡µæ•…äº‹å†…å®¹]
ç¬¬5é¡µï¼š[ç¬¬5é¡µæ’å›¾æè¿°ï¼Œå¯¹åº”ç¬¬5é¡µæ•…äº‹å†…å®¹]
ç»“å°¾ï¼š[ç»“å°¾æ’å›¾æè¿°ï¼Œæ¸©é¦¨åœ†æ»¡çš„æ•…äº‹ç»“å±€]

æ³¨æ„ï¼šæ¯ä¸ªæè¿°80-120å­—ï¼Œè¦å…·ä½“ç”ŸåŠ¨ï¼Œä¾¿äºAIç»˜å›¾ç†è§£ã€‚`
}

// æ¨¡æ‹Ÿå¿«é€Ÿç‰ˆæœ¬æç¤ºè¯ç”Ÿæˆ
function generateMockFastPrompt(params) {
  const characterInfo = params.characters.map(char => 
    `${char.name}ï¼š${char.analysis.split('ï¼Œ').slice(0, 3).join('ï¼Œ')}`
  ).join('ï¼›')

  return `ä½œä¸ºå„¿ç«¥ç»˜æœ¬æ’ç”»å¸ˆï¼Œä¸ºã€Š${params.title}ã€‹ç”Ÿæˆæ’å›¾æè¿°ã€‚

è§’è‰²ï¼š${characterInfo}

æ•…äº‹ï¼š${params.paragraphs.map((p, i) => `${i + 1}.${p}`).join(' ')}

è¦æ±‚ï¼šä¿æŒè§’è‰²ä¸€è‡´ï¼Œæ¸©é¦¨å„¿ç«¥é£æ ¼ï¼Œæ¯ä¸ªæè¿°60-80å­—ã€‚

æ ¼å¼ï¼š
å°é¢ï¼š[æè¿°]
é¡µ1ï¼š[æè¿°]
é¡µ2ï¼š[æè¿°]
é¡µ3ï¼š[æè¿°]
é¡µ4ï¼š[æè¿°]
é¡µ5ï¼š[æè¿°]
ç»“å°¾ï¼š[æè¿°]`
}

// æ¨¡æ‹Ÿå“åº”è§£æ
function parseMockResponse(content, expectedPages) {
  const lines = content.split('\n').filter(line => line.trim())
  
  // æå–å°é¢
  let cover = ''
  const coverLine = lines.find(line => line.startsWith('å°é¢ï¼š'))
  if (coverLine) {
    cover = coverLine.replace('å°é¢ï¼š', '').trim()
  }
  
  // æå–ç»“å°¾
  let ending = ''
  const endingLine = lines.find(line => line.startsWith('ç»“å°¾ï¼š'))
  if (endingLine) {
    ending = endingLine.replace('ç»“å°¾ï¼š', '').trim()
  }
  
  // æå–å„é¡µ
  const pages = []
  for (let i = 1; i <= expectedPages; i++) {
    const pageLine = lines.find(line => line.startsWith(`ç¬¬${i}é¡µï¼š`))
    if (pageLine) {
      pages.push(pageLine.replace(`ç¬¬${i}é¡µï¼š`, '').trim())
    } else {
      pages.push(`æ¸©é¦¨çš„å„¿ç«¥ç»˜æœ¬æ’å›¾ï¼Œå±•ç°ç¬¬${i}é¡µçš„æ•…äº‹æƒ…èŠ‚ï¼Œä¿æŒè§’è‰²å½¢è±¡ä¸€è‡´`)
    }
  }
  
  return { cover, pages, ending }
}

// è¿è¡Œæµ‹è¯•
testPromptPerformance()