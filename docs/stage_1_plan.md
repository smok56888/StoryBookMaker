# 阶段一实施计划

本文档结合当前前端代码现状与 `stage_1.md` 需求，详细规划阶段一的开发任务。每一项均以可交付、可测试为目标，便于后续追踪。

## 1. 豆包大模型能力对接
### 1.1 文本生成、图片识别、文生图API接入
- [ ] 新建 `/lib/arkApi.ts`，封装豆包API请求逻辑（含API Key、模型ID、BaseURL等配置）
- [ ] 提供统一的 `generateStory`、`analyzeImage`、`generateImage` 等方法，返回结构与需求一致
- [ ] 支持图片base64处理、watermark参数
- [ ] 支持错误处理与前端toast提示
- [ ] 【建议】将提示词生成逻辑单独封装，便于后续优化和复用

## 2. 后端接口梳理与实现
### 2.1 识别前端所需接口
- [ ] 设计并实现如下API（可用 Next.js API routes 或单独后端服务）：
  - `/api/story/generate`：故事生成/重新生成
  - `/api/story/analyze-image`：角色图片分析
  - `/api/story/prompts`：插图提示词生成
  - `/api/story/image`：插图生成
  - `/api/story/complete`：完成创作
  - `/api/story/pdf`：PDF下载
- [ ] 每个API route需严格按stage_1.md描述的输入输出实现
- [ ] 支持草稿保存、编辑、异常处理
- [ ] 【建议】所有API接口应有详细的错误码和错误信息，便于前端toast友好提示

## 3. 前端交互与功能调整
### 3.1 故事生成阶段
- [ ] 取消每段落的刷新操作，仅保留段落编辑
- [ ] 生成故事按钮可多次点击，每次都可重新生成
- [ ] 增加段落个数输入（默认5），传递给后端

### 3.2 插图生成阶段
- [ ] 在插图生成页导航栏下方增加“生成提示词”按钮，调用后端接口，填充每页提示词
- [ ] 展示方式调整：封面、第N页、结尾均为左图右词，提示词可编辑，右上角有生成插图按钮
- [ ] 正文、结尾页面交互与展示方式调整，保持与正文一致

### 3.3 绘本预览阶段
- [ ] 预览页图片和文字呈现方式与历史作品页一致

### 3.4 其他
- [ ] 故事生成后自动保存草稿，支持随时继续编辑
- [ ] 支持绘本全流程信息的重新编辑
- [ ] 前端所有接口异常需toast提示具体原因
- [ ] 【建议】所有用户输入和API交互均需做异常与边界校验，提升产品健壮性

## 4. 任务拆解与优先级建议
1. Ark API 封装与测试
2. Next.js API routes/后端接口实现（mock→真实）
3. 前端故事生成页调整（段落数、按钮、刷新逻辑）
4. 前端插图生成页调整（提示词、展示、交互）
5. 前端预览页调整
6. 草稿/编辑/异常处理完善

---

如有超出需求部分的设计或实现建议，将在每个子任务前以【建议】标注，并与需求方沟通确认后执行。

如需进一步细化每个子任务的技术方案或接口文档，请随时告知。 