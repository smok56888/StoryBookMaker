本文档描述了第一阶段需要实现的功能

1. 对接豆包的文本大模型和文生图大模型，提供诸如图片识别、故事生成、绘本插图生成等底层能力
1.1 豆包接入信息：
 #豆包API配置
ARK_BASE_URL=https://ark.cn-beijing.volces.com/api/v3
# 这个是17701089232的信息接入key
ARK_API_KEY=75879918-5f2c-4c02-8276-caf865b06b06
# 这个是文生图模型
ARK_TEXT_TO_IMAGE_MODEL=doubao-seedream-3-0-t2i-250415
# 这个是文本生成和图片识别的模型
ARK_IMAGE_ANALYSIS_MODEL=doubao-seed-1-6-250615
1.2 使用豆包文生图时，约束豆包固定返回base64格式图片，且设置watermark为false

2. 识别当前前端项目所需的后端接口，分别生产对应的url连接，并完成对应url对应的后端逻辑。
2.1 故事生成/重新生成：
    接收：接收传入的多个角色信息【姓名、年龄、性别、图片】、故事梗概、风格约束、故事段落数，输出分段落的绘本故事
    处理逻辑：
        * 对于上传的每个角色图片，调用ARK_IMAGE_ANALYSIS_MODEL模型接口，解析出人物核心要素，包括头部、躯干、四肢等，细节方面要包含五官、表情神态、发型发色、上衣、下衣、袜子等信息，将其缓存到故事ID下
        * 基于角色信息、故事梗概，在限定的风格和段落内，调用豆包ARK_IMAGE_ANALYSIS_MODEL模型进行绘本故事生成，故事要包含完整童话故事的要素，每个段落字数在30~70之间；故事换成到故事ID下
    输出：分段落的童话故事、含标题
2.2 插图提示词生成：
    接收：故事ID
    处理逻辑：
        * 通过故事ID从缓存获取故事角色信息、故事段落信息
        * 调用ARK_IMAGE_ANALYSIS_MODEL模型接口，将所有上下文信息传递过去，将模型给出绘本封面、插图、结尾页的情景描述
        * 在提示词中需要特别强调，仅需要给出绘本情景的客观描述，不可以出现任何对话信息和文字信息
        * 在提示词中需要特别强调，需要保持绘本正文前后每一页的故事连贯性、风格一致性、任务一致性
    输出：包含封面、插图页、结尾页等每一页插图描述的信息
2.3 插图生成：
    接收：前端传递的提示词、故事ID、故事标题
    处理逻辑：调用模型ARK_TEXT_TO_IMAGE_MODEL接口，生成base64格式图片，其中
        * 封面图片，w1024h1448尺寸，无水印，文字仅需包含故事标题
        * 正文图片，w1024h1024尺寸，无水印，不包含任何故事
        * 结尾图片，w1024h1448尺寸，无水印
    输出：图片信息
2.4 完成创作：
    接收：故事ID
    处理逻辑：修改故事状态、保存故事
    输出：成功状态
2.5 PDF下载：
    输入：故事ID
    处理逻辑：获取故事ID相关信息，组装成PDF，其中PDF组装按以下逻辑
        * PDF整体结构为A4大小，内容上需要包含封面页、正文页、结尾页
        * 封面页需要将封面图片拉伸到A4比例平铺在页面中间，边缘无需留空隙
        * 中间页，需要分别填充图片和故事段落，
        ** 其中图片放置在页面中上方，距上距左距右均留30px空隙。
        ** 下方为文字框区域，需要距图片、距左距右距下各留30px空隙；
        ** 文字放置在文本框中，大小18px，行间距1.5倍字体大小，文字超出框的部分截断
        ** 正文页留白的部分需要整体采用浅色渐变色填充，无需其他造型装饰
        * 结尾页需要将结尾图片拉伸到A4比例平铺在页面中间，边缘无需留空隙
    输出：PDF文件里
接收用户补充提示词、段落故事，利用缓存的角色信息、故事
2.8 其他逻辑补充：
    * 对于每一次故事创作，在故事生成之后需要保存草稿状态，支持后续任何时刻继续编辑和创作
    * 对于每一个绘本，需要支持重新编辑创作过程中的任何信息
    * 异常处理过程，需要在前端报错的地方已toast形式提示错误的具体原因
    * 针对任一单独场景的豆包API调用，都需要将提示词生成逻辑单独封装，以便后续对提示词进行优化
    * 对于默认提示词，需要强调本故事是给3~6岁儿童看的，需要保持童真可爱的风格进行故事讲述，以及可爱童话风格进行绘图


3. 前端对应交互上的调整
3.1 在绘本创作的故事生成阶段，取消每个段落的刷新操作，保留单个段落编辑功能
3.2 在绘本创作的故事生成阶段，生成故事按钮目前点击一次之后置灰了，改为点击后还可点击，触发同样的接口。
3.3 在绘本创作的故事生成阶段，在生成故事按钮之前，增加段落个数的输入，默认值5，用于控制生成故事的段落数，需要传递给后端。
3.4 在绘本创作的插图生成阶段，在导航栏下方增加提示词生成按钮，点击后触发提示词生成功能，并将接口返回的信息填充到下方每一页的提示词展示区域。
3.5 在绘本创作的插图生成阶段，调整正文结尾的展示方式，保持和正文相关的交互，以正文、第一页、第N页、结尾的形式处理每一个页面。
3.6 在绘本创作的插图生成阶段，调整封面、第N页、结尾每一个页面的展示，左侧展示图片，右侧展示提示词，提示词可编辑，右上方放置生成插图按钮。
3.7 在绘本创作的绘本预览阶段，绘本图片和文字的呈现方式改为和历史作品中的呈现